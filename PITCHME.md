### しくじりISUCON12

---


### 目次
1. 前提
1. 準備編
1. 本番編


---


### 前提
ISUCONとは
お題となるWebサービスを、決められたレギュレーションの中で限界まで高速化を図るチューニングバトル（公式ブログより）

やることとしてはお題として与えられたWebシステムを8時間かけて高速化する

---
### 前提
チーム名 とあるアルター使い
参加者
かい(yoto190yen)
2年目 今はrubyが得意

まさ(daylight55)
先輩


---


### 準備編
開催一か月前
6/11 まさが0次予選(予選出場応募)通過 (かいは寝てた)
7/23の予選までにやったこと
主にパフォーマンスチューニングの本を読んでた
過去のISUCON参加者の記事を読んだり公式の解説を見たりしてた
---?image=assets/book.jpg
https://isucon.net/archives/56044867.html

--- 
### 準備編
### しくじりポイント1
もっと早く準備するべきだった!
本読んだり記事読んだりしたけどそれだけでできるわけがない！！！
本格的にまさと準備を始めたのは予選の1週間前！

---
### 準備編
本番1週間前にやったこと
- 本番で楽にできるようにスクリプトを組んでいた
  - ログを見るためのツール(alp)やMySQLのクエリを分析するツールのインストール
  - デプロイからベンチマークテストの実行から結果をコミットする
  - アプリの言語変更(rubyでやる)
- 過去の予選問題の環境を用意し上記スクリプトを試す
- MySQLやNginxのconfigに設定したいことを書いておく
  - alp用のlog出力用の設定
  - MySQLでスロークエリログ(実行に時間のかかるクエリを出力するログ)を出力できる設定

あれ？それだけ？実際にパフォーマンスチューニングはしてないの？ |
### してません |

---
###  しくじりポイント1
準備が全然できなかった
まさともっと連絡を取り合うべきだった。
- スクリプトの準備で本番前日になり何をしたら早くなるか実際に試せれていない
- 実際に過去問でパフォーマンスチューニングしてみたかった

---
### 本番編 序盤
オープニング視聴(問題開示)
https://youtu.be/75YnJ_3289g?list=TLGG9Nvs71b8ogEyODA3MjAyMg
eSportsならぬisuportsのリーダーボードの高速化

CloudFormationで環境構築 実際にアクセスできるか確認
ベンチマークも実行 初期はgoで2600点
頑張って用意したセットアップ用のスクリプトを実行

---
### しくじりポイント2
素直にスクリプトが実行されない

過去問と同じ想定でスクリプトを用意したが結構変わっている
例えば
- ベンチマークの実行はポータルサイトから実行するのみ(前はローカルでも試せれた)
- アプリの言語の変更方法
- DBの初期化方法(前はinit.shを実行する想定だったが今回はいじらない)

環境を構築できたがこの時点でお昼

---
### 本番編 中盤
ちゃんと環境も用意できて言語もrubyに変更できたが
ベンチマーク実行結果 1000点
ベンチマークのログを見るとエラーが出ており減点されていた。
エラーの解決を目指すが解決しない
エラーが出る中,DBにインデックスを張ったり、ユーザーIDの発行が複雑なのでuuidの発行をするようにした。
何故エラーが出るのか解決しないまま15時へ

---
### しくじりポイント3
エラーが出る中、チューニングするが依然とエラーが出るので高速化できたかわからない
1から100を目指すつもりが0から1を目指していた。
8時間という制限があるしもっと早めにgoに戻すこともできたはず
16~17時へ

---
### 本番編 後編
もう残り1時間というところでgoに戻すことに
DBもいじったことでエラーになったためgoに戻すだけでもうまくいかず別サーバーのDBのdumpをとってきて直す。
2600点に戻り、すぐできるインデックスを張り、3600点へ！
本来であれば3台のサーバーでDBとアプリケーションを分けたかったが時間が足りず断念

---
### 結果
少し点数が下がったが3324点でFinish
---?image=assets/book.jpg
結果としてやったことはSQLにインデックスを張っただけ
これで参加チーム700チームある中の300位でした(0点のチームや失格となったチームが多いため)

---
### 完走した感想
初めての参加で勉強不足でしかなかったがミドルウェアやログの見方など多くのことを学べた。
来年も参加できたら参加したい。成長しかない
